input {
  kafka {
    bootstrap_servers => "kafka1:29092,kafka2:29093,kafka3:29094"
    topics => ["${KAFKA_TOPIC_RAW_DATA:Emotibit_rawdata}"]
    group_id => "logstach_storage_rawdata"
    auto_offset_reset => "latest"
    codec => "json"
    consumer_threads => 4
    max_poll_records => 1
  }
}

filter {
  mutate {
    remove_field => ["@version", "@timestamp","event"]
  }
}

output {
    stdout {
        codec => rubydebug
    }

    # Couch DB sync
    http {
        http_method => "post"
        url => "http://${COUCHDB_HOST:localhost}:${COUCHDB_PORT:5984}/${COUCHDB_DATABASE_RAW:iot-sensors-raw}"
        format => "json"
        content_type => "application/json"
        user => "${COUCHDB_USER:}"
        password => "${COUCHDB_PASSWORD:}"
    }
}