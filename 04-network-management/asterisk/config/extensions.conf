; =============================================================================
; Dialplan Configuration
; https://docs.asterisk.org/Configuration/Dialplan/
; =============================================================================

[general]
static=yes
writeprotect=no
clearglobalvars=no

[globals]
; Global variables
OPERATOR=100
DIRECTORY_CONTEXT=internal

; -----------------------------------------------------------------------------
; Internal Context - Main dialplan for internal calls
; -----------------------------------------------------------------------------
[internal]

; Internal extension dialing (100-199)
exten => _1XX,1,NoOp(Calling internal extension ${EXTEN})
 same => n,Set(CALLERID(name)=${CALLERID(name)})
 same => n,Dial(PJSIP/${EXTEN},30,tTm(ring))
 same => n,GotoIf($["${DIALSTATUS}" = "BUSY"]?busy:unavail)
 same => n(busy),VoiceMail(${EXTEN}@default,b)
 same => n,Hangup()
 same => n(unavail),VoiceMail(${EXTEN}@default,u)
 same => n,Hangup()

; Voicemail access
exten => *98,1,NoOp(Voicemail access for ${CALLERID(num)})
 same => n,Answer()
 same => n,Wait(1)
 same => n,VoiceMailMain(${CALLERID(num)}@default)
 same => n,Hangup()

; Check voicemail for any mailbox
exten => *97,1,NoOp(Voicemail access - any mailbox)
 same => n,Answer()
 same => n,Wait(1)
 same => n,VoiceMailMain(@default)
 same => n,Hangup()

; Echo test
exten => *43,1,NoOp(Echo test)
 same => n,Answer()
 same => n,Playback(demo-echotest)
 same => n,Echo()
 same => n,Hangup()

; Speaking clock
exten => *60,1,NoOp(Speaking clock)
 same => n,Answer()
 same => n,Wait(1)
 same => n,SayUnixTime(,,ABdY 'digits/at' IMp)
 same => n,Hangup()

; Music on hold test
exten => *65,1,NoOp(Music on hold test)
 same => n,Answer()
 same => n,MusicOnHold(default,30)
 same => n,Hangup()

; Conference room 600
exten => 600,1,NoOp(Conference room)
 same => n,Answer()
 same => n,Playback(confbridge-join)
 same => n,ConfBridge(1,default_bridge,default_user)
 same => n,Hangup()

; Admin conference room 601
exten => 601,1,NoOp(Admin conference room)
 same => n,Answer()
 same => n,Playback(confbridge-join)
 same => n,ConfBridge(1,default_bridge,admin_user)
 same => n,Hangup()

; Operator
exten => 0,1,NoOp(Operator)
 same => n,Dial(PJSIP/${OPERATOR},60)
 same => n,Hangup()

; Invalid extension
exten => i,1,NoOp(Invalid extension dialed: ${INVALID_EXTEN})
 same => n,Playback(pbx-invalid)
 same => n,Hangup()

; Timeout
exten => t,1,NoOp(Timeout)
 same => n,Playback(vm-goodbye)
 same => n,Hangup()

; -----------------------------------------------------------------------------
; From Trunk Context - Incoming calls from SIP trunk
; -----------------------------------------------------------------------------
[from-trunk]

; Route incoming calls to operator
exten => _X.,1,NoOp(Incoming call from trunk: ${CALLERID(all)})
 same => n,Dial(PJSIP/${OPERATOR},30)
 same => n,VoiceMail(${OPERATOR}@default,u)
 same => n,Hangup()

; -----------------------------------------------------------------------------
; Outbound Context - Outgoing calls via SIP trunk
; -----------------------------------------------------------------------------
[outbound]

; Local calls (example: 7-digit numbers)
; exten => _NXXXXXX,1,NoOp(Local call to ${EXTEN})
;  same => n,Dial(PJSIP/${EXTEN}@trunk-provider)
;  same => n,Hangup()

; Long distance (example: 10-digit numbers)
; exten => _NXXNXXXXXX,1,NoOp(Long distance call to ${EXTEN})
;  same => n,Dial(PJSIP/1${EXTEN}@trunk-provider)
;  same => n,Hangup()

; International (example: 011 + country code)
; exten => _011.,1,NoOp(International call to ${EXTEN})
;  same => n,Dial(PJSIP/${EXTEN}@trunk-provider)
;  same => n,Hangup()

; Emergency
; exten => 911,1,NoOp(Emergency call)
;  same => n,Dial(PJSIP/911@trunk-provider)
;  same => n,Hangup()
